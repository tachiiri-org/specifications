{
  "on_duplicate_after_success": {
    "action": "return_stored_response",
    "return": {
      "status": "stored",
      "body": "stored_inline_if_present_else_empty",
      "headers_subset": "stored_subset_if_present_else_empty"
    },
    "add_headers_on_replay": {
      "x-idempotency-replayed": "true"
    }
  },
  "on_duplicate_while_inflight": {
    "action": "wait_up_to_ms_then_return",
    "wait_up_to_ms": 2000,
    "on_timeout": {
      "status": 202,
      "error_code": "idempotency_inflight",
      "message": "request is currently being processed",
      "headers": {
        "retry-after": "2"
      }
    }
  },
  "response_headers_subset_allowlist": [
    "content-type",
    "location",
    "etag",
    "cache-control",
    "x-request-id"
  ]
}