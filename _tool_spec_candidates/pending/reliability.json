{
  "idempotency": {
    "enabled": true,
    "phase": "protocol_reserved_then_incremental_implementation",
    "header": "Idempotency-Key",
    "applies_to": [
      "POST",
      "PUT"
    ],
    "scope": "per_actor_per_rpc_method",
    "semantics": "same key + same actor + same rpc_method returns the same result without duplicating side effects",
    "storage": "service-local (D1/DO) when implemented",
    "error_behavior": {
      "conflict_on_mismatch": "409"
    }
  },
  "rate_limiting": {
    "gateway": {
      "enabled": true,
      "granularity": [
        "ip",
        "actor.sub",
        "tenant_id"
      ],
      "purpose": "coarse protection and global budget",
      "implementation": "existing gateway rate limit policy"
    },
    "service": {
      "enabled": true,
      "granularity": [
        "domain_specific"
      ],
      "purpose": "upstream API constraints (GitHub secondary limits, Google quota, R2 cost control)",
      "implementation": "existing per-service rate_limit middleware"
    }
  },
  "resilience": {
    "principle": "domain-proximal resilience lives in services",
    "service_features": [
      "singleflight",
      "token_bucket/semaphore limiters",
      "dependency_guard",
      "cache (where appropriate)"
    ],
    "gateway_features": [
      "basic timeouts",
      "coarse circuit-break style deny (optional)"
    ]
  }
}