{
  "internet_facing": false,
  "service_binding_only": true,
  "untrusted_by_default": true,
  "allowed_clients": [
    "internal_gateway"
  ],
  "authn_input": {
    "kind": "internal_assertion",
    "header": "x-internal-assertion"
  },
  "routing_contract": {
    "base_path": "/adapter",
    "path_template": "/adapter/{service}/{resource}/{property}/{operation}"
  },
  "authorization": {
    "mode": "policy_lookup",
    "policy_ref": "adapter/policies.json",
    "policy_key": "{service}/{resource}/{property}/{operation}",
    "default_decision": "deny",
    "on_deny_error": {
      "error_code": "policy_denied",
      "status": 403
    }
  },
  "trusted_headers": {
    "consumed_by_receiver": [
      "content-type",
      "traceparent",
      "x-internal-assertion",
      "x-idempotency-key"
    ],
    "passthrough_allowlist": [
      "traceparent"
    ],
    "drop": [
      "authorization",
      "cookie",
      "origin",
      "referer",
      "user-agent",
      "x-forwarded-for",
      "x-real-ip",
      "cf-connecting-ip",
      "cf-ray",
      "x-request-id",
      "forwarded"
    ]
  },
  "external_egress": {
    "forward_header_allowlist_to_upstream": [
      "content-type",
      "accept"
    ],
    "forbid_forwarding_sensitive_headers": [
      "authorization",
      "cookie",
      "x-internal-assertion",
      "x-idempotency-key"
    ]
  },
  "audit_log": {
    "enabled": true,
    "required_fields": [
      "request_id",
      "trace_id",
      "actor.sub",
      "actor.tenant",
      "service",
      "resource",
      "property",
      "operation",
      "policy_decision",
      "credential_type",
      "upstream.target",
      "upstream.method",
      "upstream.path",
      "status",
      "error_code"
    ],
    "mask": {
      "query_keys": [
        "access_token",
        "code"
      ],
      "headers": [
        "authorization",
        "cookie"
      ]
    }
  },
  "error_behavior": {
    "shape_ref": "response/error.json",
    "response_headers": {
      "x-request-id": "request_id"
    }
  }
}